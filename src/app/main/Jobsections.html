<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JobPulse - Trending Jobs Platform</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              DEFAULT: '#0a66c2', // LinkedIn blue
              light: '#e8f0fe',
              dark: '#004182',
            },
            secondary: {
              DEFAULT: '#057642', // Green for "Apply" buttons
            },
            neutral: {
              DEFAULT: '#f3f2ef', // LinkedIn background
              dark: '#666666',
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer components {
      .btn {
        @apply px-4 py-2 rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2;
      }
      .btn-primary {
        @apply bg-primary text-white hover:bg-primary-dark focus:ring-primary;
      }
      .btn-outline {
        @apply border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary;
      }
      .btn-secondary {
        @apply bg-secondary text-white hover:bg-green-700 focus:ring-green-500;
      }
      .card {
        @apply bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow;
      }
      .input {
        @apply w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary;
      }
      .badge {
        @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
      }
      .badge-blue {
        @apply bg-blue-100 text-blue-800;
      }
      .badge-green {
        @apply bg-green-100 text-green-800;
      }
      .badge-purple {
        @apply bg-purple-100 text-purple-800;
      }
      .badge-orange {
        @apply bg-orange-100 text-orange-800;
      }
    }
  </style>
  <!-- Inter font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
</head>

<body class="bg-neutral min-h-screen">
  <!-- Header -->
  <header class="sticky top-0 z-10 bg-white border-b border-gray-200">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center">
        <a href="../../../index.html" class="flex items-center space-x-2">
          <i class="fas fa-compass text-primary text-xl"></i>
          <span class="text-xl font-bold">CareerCompass</span>
        </a>
        <div class="hidden md:flex space-x-6 ml-8">
          <a href="Home.html" class="flex items-center text-gray-600 hover:text-primary">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
            Assessment
          </a>
          <a href="AiRoadmap.html" class="flex items-center text-gray-600 hover:text-primary">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
            </svg>
            Roadmap
          </a>
          <a href="Jobsections.html" class="flex items-center text-primary font-medium">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            Jobs
          </a>
        </div>
      </div>
      <div class="flex items-center space-x-4">
        <button id="insights-button" class="btn btn-outline hidden md:block">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 inline" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
          </svg>
          Job Insights
        </button>
        <div class="flex items-center space-x-2">
          <div class="relative">
            <img src="https://ui-avatars.com/api/?name=User&background=0D8ABC&color=fff" alt="User"
              class="w-8 h-8 rounded-full">
          </div>
          <a href="../../../index.html" class="text-gray-600 hover:text-primary hidden md:block">
            <i class="fas fa-sign-out-alt"></i>
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-6">
    <!-- Search and Filters -->
    <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
      <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1">
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            <input type="text" id="search-input" class="input pl-10" placeholder="Search jobs, skills, companies">
          </div>
        </div>
        <div class="flex gap-2">
          <select id="location-filter" class="input">
            <option value="">All Locations</option>
            <option value="remote">Remote</option>
            <option value="new-york">New York</option>
            <option value="san-francisco">San Francisco</option>
            <option value="london">London</option>
            <option value="berlin">Berlin</option>
          </select>
          <select id="job-type-filter" class="input">
            <option value="">All Job Types</option>
            <option value="full-time">Full-time</option>
            <option value="part-time">Part-time</option>
            <option value="contract">Contract</option>
            <option value="internship">Internship</option>
          </select>
        </div>
      </div>
      <div class="mt-4 flex flex-wrap gap-2" id="filter-tags">
        <!-- Filter tags will be added here -->
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Main Content -->
      <div class="lg:col-span-2">
        <h2 class="text-xl font-bold mb-4">Trending Jobs</h2>

        <!-- Job Listings -->
        <div id="job-listings" class="space-y-4">
          <!-- Job cards will be dynamically inserted here -->
          <div class="animate-pulse space-y-4">
            <div class="h-32 bg-gray-200 rounded"></div>
            <div class="h-32 bg-gray-200 rounded"></div>
            <div class="h-32 bg-gray-200 rounded"></div>
          </div>
        </div>

        <!-- Loading More -->
        <div class="text-center mt-8">
          <button id="load-more" class="btn btn-outline">Load More Jobs</button>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="space-y-6">
        <!-- Job Insights -->
        <div class="bg-white rounded-lg shadow-sm p-4">
          <h3 class="font-bold text-lg mb-3">Job Market Insights</h3>
          <div id="job-insights" class="text-gray-600 text-sm space-y-3">
            <p class="animate-pulse h-4 bg-gray-200 rounded"></p>
            <p class="animate-pulse h-4 bg-gray-200 rounded"></p>
            <p class="animate-pulse h-4 bg-gray-200 rounded"></p>
          </div>
        </div>

        <!-- Trending Skills -->
        <div class="bg-white rounded-lg shadow-sm p-4">
          <h3 class="font-bold text-lg mb-3">Trending Skills</h3>
          <div id="trending-skills" class="flex flex-wrap gap-2">
            <!-- Skills will be dynamically inserted here -->
            <div class="animate-pulse h-6 w-16 bg-gray-200 rounded-full"></div>
            <div class="animate-pulse h-6 w-20 bg-gray-200 rounded-full"></div>
            <div class="animate-pulse h-6 w-24 bg-gray-200 rounded-full"></div>
            <div class="animate-pulse h-6 w-16 bg-gray-200 rounded-full"></div>
            <div class="animate-pulse h-6 w-20 bg-gray-200 rounded-full"></div>
          </div>
        </div>

        <!-- Suggested Jobs -->
        <div class="bg-white rounded-lg shadow-sm p-4">
          <h3 class="font-bold text-lg mb-3">Suggested For You</h3>
          <div id="suggested-jobs" class="space-y-4">
            <!-- Suggested jobs will be dynamically inserted here -->
            <div class="animate-pulse h-16 bg-gray-200 rounded"></div>
            <div class="animate-pulse h-16 bg-gray-200 rounded"></div>
            <div class="animate-pulse h-16 bg-gray-200 rounded"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Job Insights Modal -->
  <div id="insights-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Job Market Insights</h2>
        <button id="close-insights" class="text-gray-500 hover:text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div id="insights-content" class="prose max-w-none">
        <div class="animate-pulse space-y-4">
          <div class="h-4 bg-gray-200 rounded w-3/4"></div>
          <div class="h-4 bg-gray-200 rounded"></div>
          <div class="h-4 bg-gray-200 rounded"></div>
          <div class="h-4 bg-gray-200 rounded w-5/6"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // State management
    const state = {
      // IMPORTANT: Replace with your actual Gemini API key
      apiKey: 'AIzaSyBasaBU3srwcOqVQoyT7uZmtXPa4NRi6gU', // Replace this with your actual API key
      jobs: [],
      filteredJobs: [],
      suggestedJobs: [],
      trendingSkills: [],
      jobInsights: '',
      detailedInsights: '',
      filters: {
        search: '',
        location: '',
        jobType: ''
      },
      isLoading: true,
      page: 1,
      savedJobs: JSON.parse(localStorage.getItem('savedJobs') || '[]')
    };

    // DOM Elements
    // API Key Modal elements removed
    const searchInput = document.getElementById('search-input');
    const locationFilter = document.getElementById('location-filter');
    const jobTypeFilter = document.getElementById('job-type-filter');
    const filterTags = document.getElementById('filter-tags');

    const jobListings = document.getElementById('job-listings');
    const loadMoreButton = document.getElementById('load-more');

    const jobInsightsSection = document.getElementById('job-insights');
    const trendingSkillsSection = document.getElementById('trending-skills');
    const suggestedJobsSection = document.getElementById('suggested-jobs');

    const insightsButton = document.getElementById('insights-button');
    const insightsModal = document.getElementById('insights-modal');
    const closeInsightsButton = document.getElementById('close-insights');
    const insightsContent = document.getElementById('insights-content');

    // Initialize app immediately - no API key check needed
    initializeApp();

    // Event Listeners
    // API key-related event listeners removed

    searchInput.addEventListener('input', (e) => {
      state.filters.search = e.target.value.trim().toLowerCase();
      applyFilters();
    });

    locationFilter.addEventListener('change', (e) => {
      state.filters.location = e.target.value;
      updateFilterTags();
      applyFilters();
    });

    jobTypeFilter.addEventListener('change', (e) => {
      state.filters.jobType = e.target.value;
      updateFilterTags();
      applyFilters();
    });

    loadMoreButton.addEventListener('click', () => {
      state.page++;
      renderJobs();
    });

    insightsButton.addEventListener('click', () => {
      insightsModal.classList.remove('hidden');
      if (!state.detailedInsights) {
        generateDetailedInsights();
      } else {
        insightsContent.innerHTML = formatText(state.detailedInsights);
      }
    });

    closeInsightsButton.addEventListener('click', () => {
      insightsModal.classList.add('hidden');
    });

    // Functions
    async function initializeApp() {
      try {
        // Initialize with mock data first for immediate display
        initializeMockData();
        renderJobs();
        renderSuggestedJobs();

        // Then fetch AI-generated insights
        await generateJobInsights();
        await generateTrendingSkills();

        state.isLoading = false;
      } catch (error) {
        console.error('Error initializing app:', error);
        state.isLoading = false;
      }
    }

    function initializeMockData() {
      // Mock job data
      state.jobs = [
        {
          id: 1,
          title: 'Senior Frontend Developer',
          company: 'TechCorp',
          logo: 'https://ui-avatars.com/api/?name=TC&background=0D8ABC&color=fff',
          location: 'Remote',
          jobType: 'full-time',
          salary: '$120,000 - $150,000',
          posted: '2 days ago',
          description: 'We are looking for an experienced Frontend Developer proficient in React, TypeScript, and modern CSS frameworks.',
          skills: ['React', 'TypeScript', 'Tailwind CSS', 'Redux'],
          applicants: 24
        },
        {
          id: 2,
          title: 'Data Scientist',
          company: 'AnalyticsPro',
          logo: 'https://ui-avatars.com/api/?name=AP&background=4C1D95&color=fff',
          location: 'New York',
          jobType: 'full-time',
          salary: '$130,000 - $160,000',
          posted: '1 week ago',
          description: 'Join our data science team to build machine learning models and analyze large datasets for business insights.',
          skills: ['Python', 'Machine Learning', 'SQL', 'Data Visualization'],
          applicants: 42
        },
        {
          id: 3,
          title: 'DevOps Engineer',
          company: 'CloudSystems',
          logo: 'https://ui-avatars.com/api/?name=CS&background=065F46&color=fff',
          location: 'San Francisco',
          jobType: 'full-time',
          salary: '$140,000 - $170,000',
          posted: '3 days ago',
          description: 'Looking for a DevOps Engineer to manage our cloud infrastructure and CI/CD pipelines.',
          skills: ['AWS', 'Docker', 'Kubernetes', 'Terraform'],
          applicants: 18
        },
        {
          id: 4,
          title: 'UX/UI Designer',
          company: 'DesignHub',
          logo: 'https://ui-avatars.com/api/?name=DH&background=9D174D&color=fff',
          location: 'Remote',
          jobType: 'full-time',
          salary: '$90,000 - $120,000',
          posted: '5 days ago',
          description: 'Create beautiful, intuitive user interfaces for web and mobile applications.',
          skills: ['Figma', 'Adobe XD', 'User Research', 'Prototyping'],
          applicants: 36
        },
        {
          id: 5,
          title: 'Backend Developer',
          company: 'ServerStack',
          logo: 'https://ui-avatars.com/api/?name=SS&background=1E3A8A&color=fff',
          location: 'Berlin',
          jobType: 'full-time',
          salary: '€70,000 - €90,000',
          posted: '1 day ago',
          description: 'Develop and maintain scalable backend services using Node.js and MongoDB.',
          skills: ['Node.js', 'Express', 'MongoDB', 'GraphQL'],
          applicants: 15
        },
        {
          id: 6,
          title: 'Product Manager',
          company: 'InnovateCo',
          logo: 'https://ui-avatars.com/api/?name=IC&background=7C2D12&color=fff',
          location: 'London',
          jobType: 'full-time',
          salary: '£80,000 - £100,000',
          posted: '2 weeks ago',
          description: 'Lead product development from conception to launch, working with cross-functional teams.',
          skills: ['Product Strategy', 'Agile', 'User Stories', 'Market Research'],
          applicants: 53
        },
        {
          id: 7,
          title: 'Mobile Developer',
          company: 'AppWorks',
          logo: 'https://ui-avatars.com/api/?name=AW&background=5B21B6&color=fff',
          location: 'Remote',
          jobType: 'contract',
          salary: '$70 - $90 per hour',
          posted: '4 days ago',
          description: 'Develop cross-platform mobile applications using React Native.',
          skills: ['React Native', 'JavaScript', 'iOS', 'Android'],
          applicants: 29
        },
        {
          id: 8,
          title: 'Data Engineer',
          company: 'DataFlow',
          logo: 'https://ui-avatars.com/api/?name=DF&background=1E40AF&color=fff',
          location: 'San Francisco',
          jobType: 'full-time',
          salary: '$125,000 - $155,000',
          posted: '1 week ago',
          description: 'Build and maintain data pipelines to process large volumes of data efficiently.',
          skills: ['Python', 'Spark', 'Airflow', 'AWS'],
          applicants: 31
        }
      ];

      // Initialize filtered jobs
      state.filteredJobs = [...state.jobs];

      // Mock suggested jobs
      state.suggestedJobs = state.jobs.slice(0, 3);

      // Mock trending skills
      state.trendingSkills = [
        { name: 'React', count: 1243, class: 'badge-blue' },
        { name: 'Python', count: 982, class: 'badge-green' },
        { name: 'Machine Learning', count: 876, class: 'badge-purple' },
        { name: 'AWS', count: 754, class: 'badge-orange' },
        { name: 'TypeScript', count: 621, class: 'badge-blue' },
        { name: 'Docker', count: 543, class: 'badge-green' },
        { name: 'Node.js', count: 498, class: 'badge-purple' },
        { name: 'SQL', count: 432, class: 'badge-orange' }
      ];
    }

    function renderJobs() {
      // Clear loading state
      jobListings.innerHTML = '';

      // Get jobs for current page
      const jobsPerPage = 5;
      const startIndex = 0;
      const endIndex = state.page * jobsPerPage;
      const jobsToShow = state.filteredJobs.slice(startIndex, endIndex);

      if (jobsToShow.length === 0) {
        jobListings.innerHTML = `
          <div class="text-center py-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="text-lg font-medium text-gray-900">No jobs found</h3>
            <p class="text-gray-500 mt-2">Try adjusting your search filters</p>
          </div>
        `;
        loadMoreButton.classList.add('hidden');
        return;
      }

      // Render each job card
      jobsToShow.forEach(job => {
        const isSaved = state.savedJobs.includes(job.id);

        const jobCard = document.createElement('div');
        jobCard.className = 'card p-4';
        jobCard.innerHTML = `
          <div class="flex items-start">
            <img src="${job.logo}" alt="${job.company}" class="w-12 h-12 rounded mr-4">
            <div class="flex-1">
              <div class="flex justify-between">
                <h3 class="font-semibold text-lg">${job.title}</h3>
                <button class="save-job-btn text-gray-400 hover:text-primary" data-id="${job.id}">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="${isSaved ? 'currentColor' : 'none'}" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
                  </svg>
                </button>
              </div>
              <div class="text-gray-600">${job.company} · ${job.location}</div>
              <div class="mt-2 text-gray-700">${job.description}</div>
              <div class="mt-3 flex flex-wrap gap-2">
                ${job.skills.map(skill => `<span class="badge badge-blue">${skill}</span>`).join('')}
              </div>
              <div class="mt-4 flex items-center justify-between">
                <div class="text-sm text-gray-500">
                  <span>${job.posted}</span> · <span>${job.applicants} applicants</span>
                </div>
                <div class="flex gap-2">
                  <button class="btn btn-outline text-sm py-1">Easy Apply</button>
                  <button class="btn btn-secondary text-sm py-1">Apply Now</button>
                </div>
              </div>
            </div>
          </div>
        `;

        jobListings.appendChild(jobCard);
      });

      // Add event listeners to save job buttons
      document.querySelectorAll('.save-job-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const jobId = parseInt(e.currentTarget.dataset.id);
          toggleSaveJob(jobId);

          // Update the button appearance
          const isSaved = state.savedJobs.includes(jobId);
          e.currentTarget.querySelector('svg').setAttribute('fill', isSaved ? 'currentColor' : 'none');
        });
      });

      // Show/hide load more button
      if (state.filteredJobs.length > endIndex) {
        loadMoreButton.classList.remove('hidden');
      } else {
        loadMoreButton.classList.add('hidden');
      }
    }

    function renderSuggestedJobs() {
      suggestedJobsSection.innerHTML = '';

      state.suggestedJobs.forEach(job => {
        const jobElement = document.createElement('div');
        jobElement.className = 'flex items-center p-2 hover:bg-gray-50 rounded';
        jobElement.innerHTML = `
          <img src="${job.logo}" alt="${job.company}" class="w-10 h-10 rounded mr-3">
          <div class="flex-1">
            <h4 class="font-medium text-sm">${job.title}</h4>
            <div class="text-xs text-gray-500">${job.company} · ${job.location}</div>
          </div>
        `;

        suggestedJobsSection.appendChild(jobElement);
      });
    }

    function renderTrendingSkills() {
      trendingSkillsSection.innerHTML = '';

      state.trendingSkills.forEach(skill => {
        const skillElement = document.createElement('div');
        skillElement.className = `badge ${skill.class} cursor-pointer`;
        skillElement.textContent = skill.name;
        skillElement.addEventListener('click', () => {
          searchInput.value = skill.name;
          state.filters.search = skill.name.toLowerCase();
          applyFilters();
        });

        trendingSkillsSection.appendChild(skillElement);
      });
    }

    function applyFilters() {
      state.filteredJobs = state.jobs.filter(job => {
        // Search filter
        if (state.filters.search && !jobMatchesSearch(job, state.filters.search)) {
          return false;
        }

        // Location filter
        if (state.filters.location && job.location.toLowerCase() !== state.filters.location.replace('-', ' ')) {
          return false;
        }

        // Job type filter
        if (state.filters.jobType && job.jobType !== state.filters.jobType) {
          return false;
        }

        return true;
      });

      // Reset pagination
      state.page = 1;

      // Render filtered jobs
      renderJobs();
    }

    function jobMatchesSearch(job, searchTerm) {
      searchTerm = searchTerm.toLowerCase();
      return (
        job.title.toLowerCase().includes(searchTerm) ||
        job.company.toLowerCase().includes(searchTerm) ||
        job.description.toLowerCase().includes(searchTerm) ||
        job.skills.some(skill => skill.toLowerCase().includes(searchTerm))
      );
    }

    function updateFilterTags() {
      filterTags.innerHTML = '';

      if (state.filters.location) {
        addFilterTag('Location: ' + state.filters.location.replace('-', ' '), () => {
          locationFilter.value = '';
          state.filters.location = '';
          updateFilterTags();
          applyFilters();
        });
      }

      if (state.filters.jobType) {
        addFilterTag('Type: ' + state.filters.jobType.replace('-', ' '), () => {
          jobTypeFilter.value = '';
          state.filters.jobType = '';
          updateFilterTags();
          applyFilters();
        });
      }
    }

    function addFilterTag(text, removeCallback) {
      const tag = document.createElement('div');
      tag.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800';
      tag.innerHTML = `
        ${text}
        <button type="button" class="ml-1.5 inline-flex items-center justify-center h-4 w-4 rounded-full text-blue-400 hover:text-blue-500 focus:outline-none">
          <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
        </button>
      `;

      tag.querySelector('button').addEventListener('click', removeCallback);
      filterTags.appendChild(tag);
    }

    function toggleSaveJob(jobId) {
      const index = state.savedJobs.indexOf(jobId);
      if (index === -1) {
        state.savedJobs.push(jobId);
      } else {
        state.savedJobs.splice(index, 1);
      }

      // Save to localStorage
      localStorage.setItem('savedJobs', JSON.stringify(state.savedJobs));
    }

    async function generateJobInsights() {
      try {
        const prompt = `Generate 3 short, data-driven insights about the current job market trends. Each insight should be 1-2 sentences and focus on in-demand skills, industry growth, or salary trends. Format as plain text with each insight on a new line.`;

        const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=' + state.apiKey, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: prompt
              }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 1024,
            }
          })
        });

        const data = await response.json();

        if (data.error) {
          throw new Error(data.error.message || "API Error");
        }

        state.jobInsights = data.candidates[0].content.parts[0].text;
        jobInsightsSection.innerHTML = formatText(state.jobInsights);
      } catch (error) {
        console.error('Error generating job insights:', error);
        jobInsightsSection.innerHTML = `
          <p>AI-powered job market insights are currently unavailable. Please try again later.</p>
        `;
      }
    }

    async function generateDetailedInsights() {
      try {
        insightsContent.innerHTML = `
          <div class="animate-pulse space-y-4">
            <div class="h-4 bg-gray-200 rounded w-3/4"></div>
            <div class="h-4 bg-gray-200 rounded"></div>
            <div class="h-4 bg-gray-200 rounded"></div>
            <div class="h-4 bg-gray-200 rounded w-5/6"></div>
          </div>
        `;

        const prompt = `Generate a detailed analysis of current job market trends for technology professionals. Include:

1. Top 5 in-demand skills with brief explanations of why they're valuable
2. Fastest growing job categories and their projected growth rates
3. Salary trends across different tech roles
4. Remote work statistics and how they're affecting the job market
5. Advice for job seekers on how to stand out in the current market

Format your response with clear headings and bullet points where appropriate.`;

        const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=' + state.apiKey, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: prompt
              }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 2048,
            }
          })
        });

        const data = await response.json();

        if (data.error) {
          throw new Error(data.error.message || "API Error");
        }

        state.detailedInsights = data.candidates[0].content.parts[0].text;
        insightsContent.innerHTML = formatText(state.detailedInsights);
      } catch (error) {
        console.error('Error generating detailed insights:', error);
        insightsContent.innerHTML = `
          <p>Detailed job market insights are currently unavailable. Please try again later.</p>
        `;
      }
    }

    async function generateTrendingSkills() {
      try {
        const prompt = `Generate a list of 8 trending technical skills in the job market right now. For each skill, provide:
1. The skill name
2. A number representing job postings (between 400-1500)
3. A category (choose from: programming, data, cloud, design)

Format as a JSON array like this:
[
  {"name": "React", "count": 1243, "category": "programming"},
  {"name": "Python", "count": 982, "category": "programming"}
]`;

        const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=' + state.apiKey, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: prompt
              }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 1024,
            }
          })
        });

        const data = await response.json();

        if (data.error) {
          throw new Error(data.error.message || "API Error");
        }

        const text = data.candidates[0].content.parts[0].text;

        // Extract JSON from response
        const jsonMatch = text.match(/\[\s*\{[\s\S]*\}\s*\]/);
        if (jsonMatch) {
          const skills = JSON.parse(jsonMatch[0]);

          // Map categories to badge classes
          const categoryClasses = {
            'programming': 'badge-blue',
            'data': 'badge-green',
            'cloud': 'badge-purple',
            'design': 'badge-orange'
          };

          state.trendingSkills = skills.map(skill => ({
            ...skill,
            class: categoryClasses[skill.category] || 'badge-blue'
          }));

          renderTrendingSkills();
        }
      } catch (error) {
        console.error('Error generating trending skills:', error);
        // Keep using the mock data
      }
    }

    // Helper function to format text with markdown-like syntax
    function formatText(text) {
      if (!text) return '';

      // Replace **bold** with <strong>bold</strong>
      text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

      // Replace *italic* with <em>italic</em>
      text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');

      // Replace # Heading with <h3>Heading</h3>
      text = text.replace(/^# (.*?)$/gm, '<h3 class="text-lg font-bold my-3">$1</h3>');

      // Replace ## Subheading with <h4>Subheading</h4>
      text = text.replace(/^## (.*?)$/gm, '<h4 class="text-md font-semibold my-2">$1</h4>');

      // Convert bullet lists
      const bulletListRegex = /^[*\-•] (.*?)$/gm;
      if (text.match(bulletListRegex)) {
        // Find all bullet list sections
        const sections = text.split(/\n\n+/);

        for (let i = 0; i < sections.length; i++) {
          if (sections[i].match(bulletListRegex)) {
            const items = sections[i].match(bulletListRegex).map(item =>
              item.replace(bulletListRegex, '<li class="ml-5 mb-1">$1</li>')
            );
            sections[i] = `<ul class="list-disc my-3">${items.join('')}</ul>`;
          }
        }

        text = sections.join('\n\n');
      }

      // Convert numbered lists
      const numberedListRegex = /^\d+\. (.*?)$/gm;
      if (text.match(numberedListRegex)) {
        // Find all numbered list sections
        const sections = text.split(/\n\n+/);

        for (let i = 0; i < sections.length; i++) {
          if (sections[i].match(numberedListRegex)) {
            const items = sections[i].match(numberedListRegex).map(item =>
              item.replace(numberedListRegex, '<li class="ml-5 mb-1">$1</li>')
            );
            sections[i] = `<ol class="list-decimal my-3">${items.join('')}</ol>`;
          }
        }

        text = sections.join('\n\n');
      }

      // Replace newlines with <br> tags
      text = text.replace(/\n\n+/g, '</p><p class="my-2">');
      text = `<p class="my-2">${text}</p>`;

      return text;
    }
  </script>
</body>

</html>